---
title: "Initiatives environnementales post chido"
format: 
  dashboard: 
    nav-buttons: [github]
    theme: spacelab
---

```{r}
targets::tar_load(winitiatives)
```

# Cartographie

##  {.sidebar}

<br>

::: center
Bienvenue sur la plateformes des initiatives environnementales post Chido
:::

Naviguez sur cette cartographie afin de trouver les initiatives près de chez vous. Cliquez sur les initiatives afin d'avoir plus d'informations.

```{r}

library(crosstalk)

crosstalk_init <- SharedData$new(winitiatives)

filter_select("type", "Type d'initiative", crosstalk_init, ~type)

```

```{r}
filter_select("statut", "Statut de l'initiative", crosstalk_init, ~statut)
```

<br>

Afin de faire recenser votre initiative, merci d'envoyer un mail à l'adresse suivante: clement.delamare\@live.fr

## Column {width="80%"}

```{r}
#| padding: 0px

pal <- leaflet::colorFactor(pal = c("#5773CCFF", "#FFB900FF"), domain = c("À venir", "Terminé"))

initiative_card <- function(img_type, init_name, init_structure, init_date, init_inscription) {
  # img_type = "EEE.png"
  # init_name = "Arrachage d’EEE"
  # init_structure = "GEPOMAY"
  # init_date = "22/02/25"
  # init_inscription = "https://www.jeveuxaider.gouv.fr/missions-benevolat/66226/benevolat-gepomay"
  card_content <- paste0(
    "<img src='", img_type,"' style='width: 50px; height: 50px;'>",
    "<tr>",
    "<th><b><h3 style='text-align: center;'>", init_name,"</h3></b></th>",
    "<p style='text-align: left; font-size: 15px;'> structure organisatrice: <b>", init_structure, "</b></p>",
    "<p style='text-align: left; font-size: 15px;'> date: <b>", init_date, "</b></p>",
    "<a style='text-align: left'; href= '", init_inscription, "' target='_blank'> inscription ici </a>"
  )
  
  return(card_content)
  
}

leaflet::leaflet(data = crosstalk_init) |>
  leaflet::addProviderTiles(leaflet::providers$CartoDB.Positron, group = "Positron", options = leaflet::providerTileOptions(noWrap = TRUE)) |>
  leaflet::addProviderTiles(leaflet::providers$Esri.WorldImagery, group = "Esri World Imagery", options = leaflet::providerTileOptions(noWrap = TRUE))|>
  leaflet::addLayersControl(
          baseGroups = c("Positron", "Esri World Imagery"),
          position = c("topleft"),
          # overlayGroups = c("Avec Clustering", "Sans Clustering"),
          options = leaflet::layersControlOptions(collapsed = TRUE)
          ) |>
  # leaflet::addCircleMarkers() |>
  leaflet::addCircleMarkers(
          radius = 6,
          color = ~ pal(statut),
          stroke = FALSE,
          fillOpacity = 1,
          #group = "Sans Clustering",
          # clusterOptions = leaflet::markerClusterOptions(),
          popup = ~ initiative_card(image, initiatives, structure, date, inscriptions)
            ) |>
  # leaflet::addCircleMarkers(
  #         radius = 6,
  #         color = ~ pal(statut),
  #         stroke = FALSE,
  #         fillOpacity = 1,
  #         group = "Avec Clustering",
  #         clusterOptions = leaflet::markerClusterOptions(),
  #         popup =  ~initiative_card(image, initiatives, structure, date, inscriptions)
  #         ) |>
  leaflet::addLegend(pal = pal, values = ~statut, opacity = 1, na.label = "Not Available") |>
  leaflet::fitBounds(45, -12.7, 45.312, -12.95)
  
```
# Infographie

## Row {height=20%}

::: {.valuebox icon="arrow-repeat" color="vb-warning"}
Initiatives à venir

`r length(winitiatives$statut[winitiatives$statut == "À venir"])`
:::

::: {.valuebox icon="plus-circle" color="vb-info"}
Initiatives terminées

`r length(winitiatives$statut[winitiatives$statut == "Terminé"])`
:::

::: {.valuebox icon="check-circle" color="vb-success"}
Closed
:::

::: {.valuebox icon="x-circle" color="vb-danger"}
Cancelled
:::

## Row {height=80%}

```{r}
#| padding: 0px

count_init <- winitiatives |>
  dplyr::count(type)

count_init$type <- forcats::fct_reorder(count_init$type, count_init$n)

ggplot2::ggplot() +
  ggplot2::geom_col(data = count_init, ggplot2::aes(y = n, x = type), fill = "#2ca0f6", color = "#2ca0f6") +
  ggplot2::coord_flip() +
  ggplot2::theme_grey() +
  ggplot2::theme(
    axis.title = ggplot2::element_blank()
  )
```

